webpackJsonp([4],{1189:function(e,t,n){"use strict";function a(){return{type:C}}function o(e){return console.log(E,e),{type:E,payload:e}}function r(e){return{type:v,payload:e}}function l(){return{type:y}}function i(e){return{type:g,payload:e}}function c(e){return{type:b,payload:e}}function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments[1],n=T[t.type];return n?n(e,t):e}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"COUPON_GET_ADD",function(){return E}),n.d(t,"COUPON_GET_INIT",function(){return C}),n.d(t,"COUPON_GET_DELETE",function(){return v}),n.d(t,"COUPON_GET_DELETE_All",function(){return y}),n.d(t,"COUPON_GET_SELECTED",function(){return g}),n.d(t,"COUPON_GET_STARTED_CHANGE",function(){return b}),n.d(t,"COUNTER_INCREMENT",function(){return O}),t.couponGetInit=a,t.couponAdd=o,t.couponDel=r,t.couponDelAll=l,t.couponSelected=i,t.couponStartedChange=c,n.d(t,"actions",function(){return _}),t.default=s;var u,d=n(9),p=n.n(d),m=n(65),h=n.n(m),f=n(1202),E="COUPON_GET_ADD",C="COUPON_GET_INIT",v="COUPON_GET_DELETE",y="COUPON_GET_DELETE_All",g="COUPON_GET_SELECTED",b="COUPON_GET_STARTED_CHANGE",O="COUNTER_INCREMENT",S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},_={couponGetInit:a,couponDelAll:l,couponSelected:i,couponAdd:o,couponDel:r,couponStartedChange:c},T=(u={},p()(u,C,function(e){var t=f.a.get("state"),n=t.list;return Object.assign({},e,{list:[].concat(h()(n))})}),p()(u,E,function(e,t){var n=t.payload;console.log(n),n.length?(n.map(function(e){if(!e.id)return e.id="JD_"+S()}),n=n.filter(function(e){return e.url&&e.title&&e.priceLess})):n.url&&!n.id?(n.id="JD_"+S(),n=[n]):n.id&&(n=[n]);var a=Object.assign({},e,{list:[].concat(h()(e.list),h()(n))});return f.a.set("state",a),a}),p()(u,v,function(e,t){var n=t.payload,a=e.list;a.splice(a.findIndex(function(e){return e.id===n.id}),1);var o=Object.assign({},e,{list:[].concat(h()(a))});return f.a.set("state",o),o}),p()(u,y,function(e){var t=Object.assign({},e,{list:[]});return f.a.set("state",t),console.log(t),t}),p()(u,g,function(e,t){var n=t.payload;return Object.assign({},e,{list:e.list.map(function(e){return e.id===n.id&&(e.isSelected=!e.isSelected),e})})}),p()(u,b,function(e,t){var n=t.payload;return Object.assign({},e,{list:e.list.map(function(e){return e.isSelected&&(e.started=n),e})})}),u),k={list:[]}},1193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(138),o=n(1189),r=n(1238),l=Object.assign({},o.actions),i=function(e){return Object.assign({selectedCoupons:e.couponsLocal.list?e.couponsLocal.list.filter(function(e){return e.isSelected}):[]},e)};t.default=n.i(a.connect)(i,l)(r.a)},1201:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(5),l=(n.n(r),n(525)),i=function(e){var t=e.description;return o.a.createElement(l.i,{message:"提示",description:t||o.a.createElement("div",null,"抢券前请确保已登陆京东 ",o.a.createElement("a",{target:"_blank",href:"http://home.jd.com/"},"登录电脑版")," ",o.a.createElement("a",{target:"_blank",href:"https://home.m.jd.com/myJd/newhome.action"},"登录手机版")),type:"warning",showIcon:!0})};i.propTypes={},t.a=i},1202:function(e,t,n){"use strict";var a=n(1203),o=new a.a("dogpon");t.a=o},1203:function(e,t,n){"use strict";var a=n(1),o=n.n(a),r=n(8),l=n.n(r),i=function(){function e(t){o()(this,e),this.LS=null,this.name=t,this.checkLS(),this.init(t)}return l()(e,[{key:"checkLS",value:function(){return!(!window||!window.localStorage)&&(this.LS=window.localStorage,!0)}},{key:"init",value:function(e){this.LS&&(this.LS[e]?this.data=JSON.parse(this.LS[e]):this.data={})}},{key:"set",value:function(e,t){this.data[e]=t,this.LS&&(this.LS[this.name]=JSON.stringify(this.data))}},{key:"get",value:function(e){return this.data[e]?this.data[e]:{list:[]}}},{key:"del",value:function(e){return!!this.data[e]&&(delete this.data[e],this.LS[this.name]=JSON.stringify(this.data),this.data)}},{key:"clear",value:function(){return!(!this.LS||!this.name)&&(this.LS.removeItem(this.name),this.data={},!0)}}]),e}();t.a=i},1204:function(e,t,n){"use strict";var a=n(1),o=n.n(a),r=n(8),l=n.n(r),i=n(3),c=n.n(i),s=n(2),u=n.n(s),d=n(0),p=n.n(d),m=n(525),h=function(e){function t(){var e,n,a,r;o()(this,t);for(var l=arguments.length,i=Array(l),s=0;s<l;s++)i[s]=arguments[s];return n=a=c()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),a.state={started:!1,result:!1},a.componentWillReceiveProps=function(e){var t=e.item,n=e.show;t.started&&"selected"===n?a.startCoupon(t):a.endCoupon(t)},a.timer=[],a.next=0,a.startCoupon=function(e){var t=e.id,n=e.url;a.setState({started:!0,result:!0}),a.timer[t]=setInterval(function(){console.log({id:t,url:n}),this.next,$("#iframe"+t).attr("src",n),this.next=this.next+1},320)},a.endCoupon=function(e){var t=e.id;a.timer[t]&&(a.setState({result:!1}),clearInterval(a.timer[t]))},a.onCouponSelected=function(e){var t=a.props.couponSelected;a.setState({started:!1}),a.timer[e.id]&&a.endCoupon(e),t(e)},a.onCouponDel=function(e){(0,a.props.couponDel)(e)},a.onCouponLocal=function(e){(0,a.props.couponLocal)(e)},r=n,c()(a,r)}return u()(t,e),l()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.show;return p.a.createElement(m.g,{span:6,"data-url":n.url,className:"gutter-row coupon-item"},p.a.createElement("div",null,p.a.createElement("div",{className:"price"},p.a.createElement("em",null,"¥"),p.a.createElement("strong",null,n.priceLess)),p.a.createElement("div",null,p.a.createElement("span",{className:"limit"},n.condition),/m.jd/.test(n.url)?p.a.createElement("span",{className:"device"},"手机端"):p.a.createElement("span",{className:"device"},"PC端")),p.a.createElement("h3",{dangerouslySetInnerHTML:{__html:n.title}}),p.a.createElement("p",{dangerouslySetInnerHTML:{__html:n.note?n.note:"请确保已登陆京东"}}),p.a.createElement("p",null,n.baseUrl?p.a.createElement("a",{href:n.baseUrl,target:"_blank"},"直达优惠券页面"):"")),this.state.started?p.a.createElement("div",null,p.a.createElement("iframe",{id:"iframe"+n.id,src:""})):"",function(t){switch(a){case"all":return p.a.createElement("div",{className:"control justify"},p.a.createElement(m.b,{type:"primary",onClick:e.onCouponSelected.bind(e,t),disabled:t.isSelected},p.a.createElement(m.h,{type:"heart"})," 选择")," ",p.a.createElement(m.b,{type:"danger",onClick:e.onCouponDel.bind(e,t),disabled:t.isSelected},p.a.createElement(m.h,{type:"delete"})," 删除"));case"selected":return p.a.createElement("div",{className:"control justify"},e.state.result?p.a.createElement(m.b,{type:"danger",onClick:e.endCoupon.bind(e,t)},p.a.createElement(m.h,{type:"rocket"})," 结束抢券"):p.a.createElement(m.b,{type:"primary",onClick:e.startCoupon.bind(e,t)},p.a.createElement(m.h,{type:"rocket"})," 开始抢券"),p.a.createElement(m.b,{type:"danger",onClick:e.onCouponSelected.bind(e,t)},p.a.createElement(m.h,{type:"heart-o"})," 删除"));case"serve":return p.a.createElement("div",{className:"control"},p.a.createElement(m.b,{type:"primary",onClick:e.onCouponLocal.bind(e,t),disabled:t.isInLocal},p.a.createElement(m.h,{type:"cloud-download"})," ",t.isInLocal?"本地已保存":"选择到本地"))}}(n))}}]),t}(d.Component);t.a=h},1209:function(e,t,n){"use strict";var a=n(4),o=n.n(a),r=n(1),l=n.n(r),i=n(8),c=n.n(i),s=n(3),u=n.n(s),d=n(2),p=n.n(d),m=n(0),h=n.n(m),f=n(86),E=n(525),C=E.a.Item,v=E.c.TextArea,y=function(e){function t(){l()(this,t);var e=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleFormDataChange=function(t){e.setState({byData:!e.state.byData})},e.state={byData:!0},e}return p()(t,e),c()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,a=e.onCreate,r=e.form,l=r.getFieldDecorator,i={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:18}}};return h.a.createElement(E.f,{visible:t,title:"添加优惠券",okText:"添加",cancelText:"取消",onCancel:n,onOk:a},h.a.createElement(E.a,{layout:"horizontal"},h.a.createElement(C,o()({},i,{label:"数据格式"}),l("dataType",{valuePropName:"checked"})(h.a.createElement(E.l,{checkedChildren:"字段",unCheckedChildren:"JSON",onChange:this.handleFormDataChange}))),this.state.byData?h.a.createElement(C,o()({},i,{label:h.a.createElement("span",null,"数据 ",h.a.createElement(E.k,{title:"请使用优惠券数据提取工具"},h.a.createElement(f.Link,{to:"/tool"},h.a.createElement(E.h,{type:"question-circle-o"})))),help:"支持数组或者对象数据提交"}),l("data",{rules:[{required:!0,message:"请填写数据"}]})(h.a.createElement(v,{rows:4,placeholder:"请填写数据"}))):h.a.createElement("div",null,h.a.createElement(C,o()({},i,{label:"标题"}),l("title",{rules:[{required:!0,message:"请填写标题"}]})(h.a.createElement(E.c,{placeholder:"请填写标题"}))),h.a.createElement(C,o()({},i,{label:h.a.createElement("span",null,"接口地址 ",h.a.createElement(E.k,{title:"请使用优惠券接口地址提取工具"},h.a.createElement(f.Link,{to:"/tool"},h.a.createElement(E.h,{type:"question-circle-o"}))))}),l("url",{rules:[{required:!0,message:"请输入接口地址"},{pattern:/^((https:|http:)?\/\/).*jd.com+.*/,message:"请输入正确的京东接口地址）"}]})(h.a.createElement(E.c,{placeholder:"请输入京东接口地址"}))),h.a.createElement(C,o()({},i,{label:"备注信息"}),l("note")(h.a.createElement(E.c,{placeholder:"备注信息"}))),h.a.createElement(C,o()({},i,{label:"折扣力度"}),l("priceLess",{rules:[{required:!0,message:"请填写折扣力度"}]})(h.a.createElement(E.c,{placeholder:"折扣力度"}))),h.a.createElement(C,o()({},i,{label:"条件"}),l("condition")(h.a.createElement(E.c,{placeholder:"满多少可用"}))))))}}]),t}(h.a.Component),g=E.a.create()(y);t.a=g},1238:function(e,t,n){"use strict";var a=n(25),o=n.n(a),r=n(1),l=n.n(r),i=n(8),c=n.n(i),s=n(3),u=n.n(s),d=n(2),p=n.n(d),m=n(0),h=n.n(m),f=n(1204),E=n(525),C=n(6),v=n.n(C),y=n(1209),g=n(1201),b=function(e){function t(){var e,n,a,r;l()(this,t);for(var i=arguments.length,c=Array(i),s=0;s<i;s++)c[s]=arguments[s];return n=a=u()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={mode:"time",visible:!1,visibleAddCoupon:!1,date:""},a.handleOk=function(e){console.log(a.state.date),a.setState({visible:!1}),a.setTimer()},a.handleCancel=function(e){a.setState({visible:!1,visibleAddCoupon:!1})},a.handleOnChange=function(e,t){console.log(t),a.setState({date:t})},a.setCouponTime=function(){a.setState({visible:!0,date:v()(v()().valueOf()+5e3).format("YYYY-MM-DD HH:mm:ss")})},a.setTimer=function(){function e(){var a=(new Date).getTime();c++,console.log(a%1e3);var l=v()().valueOf()-(r+c*n),u=n-l;u<0&&(u=0),console.log(u),i<0||i<n?(clearTimeout(s),t.startCouponAll(),console.log((o-v()().valueOf())/1e3),console.log("时间到"),setTimeout(function(){t.endCouponAll()},3e3)):(E.j.info("距离开抢还有："+i/1e3+"s"),s=setTimeout(e,n)),i-=n}if(!a.props.selectedCoupons.length)return E.j.error("当前还没有选择任何优惠券");var t=a,n=1e3,o=v()(a.state.date).valueOf(),r=v()().valueOf(),l=r%1e3,i=o-r,c=0;console.log(i,l);var s=void 0;i>=0&&(s=setTimeout(e,1e3-l))},a.startCouponAll=function(){var e=a.props,t=e.couponStartedChange;if(!e.selectedCoupons.length)return E.j.error("当前还没有选择任何优惠券");t(!0)},a.endCouponAll=function(){var e=a.props,t=e.couponStartedChange,n=e.selectedCoupons;n.filter(function(e){return!0===e.started});if(!n.length)return E.j.error("当前还没有选择任何优惠券");t(!1)},a.addCoupon=function(){a.setState({visibleAddCoupon:!0})},a.handleCreate=function(){var e=a.props.couponAdd,t=a.form;t.validateFields(function(n,r){if(!n){if(r.data){try{r=JSON.parse(r.data)}catch(e){return E.j.error("数据格式错误")}if("object"!==(void 0===r?"undefined":o()(r)))return E.j.error("数据格式错误")}else delete r.dataType;console.log("Received values of form: ",r),e(r),t.resetFields(),a.setState({visibleAddCoupon:!1})}})},a.saveFormRef=function(e){a.form=e},a.delCouponAll=function(){(0,a.props.couponDelAll)()},r=n,u()(a,r)}return p()(t,e),c()(t,[{key:"componentDidMount",value:function(){(0,this.props.couponGetInit)()}},{key:"render",value:function(){var e=this.props,t=e.selectedCoupons,n=e.couponsLocal,a=e.couponSelected,o=e.couponDel,r=n.list;E.a.Item;return h.a.createElement("div",null,h.a.createElement(g.a,null),h.a.createElement(E.d,{style:{marginTop:24},type:"inner",title:"抢券列表",extra:h.a.createElement("span",null,h.a.createElement(E.b,{type:"primary",onClick:this.startCouponAll},"一键抢券")," ",h.a.createElement(E.b,{type:"primary",onClick:this.endCouponAll},"一键结束")," ",h.a.createElement(E.b,{type:"primary",onClick:this.setCouponTime},"定时抢券"))},h.a.createElement(E.e,{gutter:50},t.length&&t.map(function(e,t){return h.a.createElement(f.a,{item:e,key:e.id,couponSelected:a,show:"selected"})}))),h.a.createElement(E.d,{style:{marginTop:24},type:"inner",title:"优惠券列表",extra:h.a.createElement("span",null,h.a.createElement(E.b,{type:"danger",onClick:this.delCouponAll},"全部清空")," ",h.a.createElement(E.b,{type:"primary",onClick:this.addCoupon},"添加优惠券"))},h.a.createElement(E.e,{gutter:50},r&&r.length&&r.map(function(e,t){return h.a.createElement(f.a,{item:e,key:e.id,couponSelected:a,couponDel:o,show:"all"})}))),h.a.createElement(E.f,{visible:this.state.visible,okText:"确定",cancelText:"取消",onOk:this.handleOk,onCancel:this.handleCancel},h.a.createElement("div",null,h.a.createElement(E.m,{mode:this.state.mode,format:"YYYY-MM-DD HH:mm:ss",showTime:!0,value:v()(this.state.date,"YYYY-MM-DD HH:mm:ss"),onChange:this.handleOnChange,onPanelChange:this.handlePanelChange}),h.a.createElement("p",null,"准确的时间格式：2017-12-03 10:00:00，3秒后自动结束"))),h.a.createElement(y.a,{ref:this.saveFormRef,visible:this.state.visibleAddCoupon,onCancel:this.handleCancel,onCreate:this.handleCreate}))}}]),t}(m.Component);t.a=b}});