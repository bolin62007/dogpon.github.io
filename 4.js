webpackJsonp([4],{1189:function(e,t,n){"use strict";function a(e){return console.log(e),{type:p,payload:e}}function r(e){return{type:m,payload:e}}function o(e){return{type:f,payload:e}}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments[1],n=b[t.type];return n?n(e,t):e}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"COUPON_ADD",function(){return p}),n.d(t,"COUPON_SELECTED",function(){return m}),n.d(t,"COUPON_STARTED_CHANGE",function(){return f}),n.d(t,"COUNTER_INCREMENT",function(){return h}),n.d(t,"COUNTER_DOUBLE_ASYNC",function(){return C}),t.couponAdd=a,t.couponSelected=r,t.couponStartedChange=o,n.d(t,"actions",function(){return v}),t.default=l;var c,i=n(9),s=n.n(i),u=n(66),d=n.n(u),p="COUPON_ADD",m="COUPON_SELECTED",f="COUPON_STARTED_CHANGE",h="COUNTER_INCREMENT",C="COUNTER_DOUBLE_ASYNC",E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},v={couponSelected:r,couponStartedChange:o,couponAdd:a},b=(c={},s()(c,p,function(e,t){var n=t.payload;return console.log(n),n.length?(n.map(function(e){if(!e.id)return e.id="JD_"+E()}),n=n.filter(function(e){return e.url&&e.title&&e.priceLess})):n.url&&!n.id&&(n.id="JD_"+E(),n=[n]),Object.assign({},e,{list:[].concat(d()(e.list),d()(n))})}),s()(c,m,function(e,t){var n=t.payload;return Object.assign({},e,{list:e.list.map(function(e){return e.id===n.id&&(e.isSelected=!e.isSelected),e})})}),s()(c,f,function(e,t){var n=t.payload;return Object.assign({},e,{list:e.list.map(function(e){return e.isSelected&&(e.started=n),e})})}),s()(c,C,function(e,t){return 2*e}),c),g={list:[{id:"JD_1",title:"话费券",priceLess:"50",condition:"满50可用",url:"http://coupon.m.jd.com/center/receiveCoupon.json?couponId=FP_rzw62e&roleId=9522110&actId=5550d895d0e8447a82366b4667a5a079",note:"10点开抢"},{id:"JD_2",title:"仅可购买母婴玩具自营（除童装童鞋）部分商品",priceLess:"100",condition:"满399可用",url:"http://coupon.m.jd.com/center/receiveCoupon.json?couponId=FP_r6zwli&roleId=9563848&actId=f62f9b45d4f94870b0c99ecaba36ceb7",note:"16点开抢"},{id:"JD_3",title:"全品类",priceLess:"10",condition:"满200可用",url:"http://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body=%7B%22activityId%22%3A%22JnBNfziTrMkqi6mBCaegM3SdVTL%22%2C%22from%22%3A%22H5node%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3Da327e6761c5a475db749ac9c0d09000e%2CroleId%3D9491958%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%22%22%2C%22lat%22%3A%22%22%7D%7D&client=wh5&clientVersion=1.0.0&sid=2ef0a060f4976cf16ce8dacbbb4acdaa&uuid=1486988610523463373612&area=&_=1512870608248&callback=jsonp5",note:"10点开抢"},{id:"JD_4",title:"全品类",priceLess:"20",condition:"满400可用",url:"https://api.m.jd.com/client.action?functionId=newBabelAwardCollection&body=%7B%22activityId%22%3A%22JnBNfziTrMkqi6mBCaegM3SdVTL%22%2C%22from%22%3A%22H5node%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3Dbeb14768b14c4a5eb56af44d286ca58a%2CroleId%3D9490476%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%22%22%2C%22lat%22%3A%22%22%7D%7D&client=wh5&clientVersion=1.0.0&sid=2ef0a060f4976cf16ce8dacbbb4acdaa&uuid=1486988610523463373612&area=&_=1512870737852&callback=jsonp6",note:"10点开抢"},{id:"JD_5",title:"仅可购买自营尿裤部分商品",priceLess:"100",condition:"满399可用",url:"http://coupon.m.jd.com/center/receiveCoupon.json?couponId=FP_rxzlqk&roleId=9487347&actId=6bd6339fd57d45a4a91f34e0d3783e5a",note:"16点开抢"}]}},1191:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(138),r=n(1189),o=n(1209),l={couponSelected:function(e){return n.i(r.couponSelected)(e)},couponAdd:function(e){return n.i(r.couponAdd)(e)},couponStartedChange:function(e){return n.i(r.couponStartedChange)(e)}},c=function(e){return Object.assign({selectedCoupons:e.coupons.list.filter(function(e){return e.isSelected})},e)};t.default=n.i(a.connect)(c,l)(o.a)},1201:function(e,t,n){"use strict";var a=n(0),r=n.n(a),o=n(5),l=(n.n(o),n(524)),c=function(e){return r.a.createElement(l.g,{message:"提示",description:r.a.createElement("div",null,"抢券前请确保已登陆京东 ",r.a.createElement("a",{target:"_blank",href:"http://home.jd.com/"},"登录电脑版")," ",r.a.createElement("a",{target:"_blank",href:"https://home.m.jd.com/myJd/newhome.action"},"登录手机版")),type:"warning",showIcon:!0})};c.propTypes={},t.a=c},1206:function(e,t,n){"use strict";var a=n(1),r=n.n(a),o=n(8),l=n.n(o),c=n(3),i=n.n(c),s=n(2),u=n.n(s),d=n(0),p=n.n(d),m=n(524),f=function(e){function t(){var e,n,a,o;r()(this,t);for(var l=arguments.length,c=Array(l),s=0;s<l;s++)c[s]=arguments[s];return n=a=i()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={started:!1,result:!1},a.componentWillReceiveProps=function(e){var t=e.item,n=e.show;t.started&&"selected"===n?a.startCoupon(t):a.endCoupon(t)},a.timer=[],a.next=0,a.startCoupon=function(e){var t=e.id,n=e.url;a.setState({started:!0,result:!0}),a.timer[t]=setInterval(function(){console.log({id:t,url:n}),this.next,$("#iframe"+t).attr("src",n),this.next=this.next+1},320)},a.endCoupon=function(e){var t=e.id;a.timer[t]&&(a.setState({result:!1}),clearInterval(a.timer[t]))},a.onCouponSelected=function(e){var t=a.props.couponSelected;a.setState({started:!1}),a.timer[e.id]&&a.endCoupon(e),t(e)},o=n,i()(a,o)}return u()(t,e),l()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.item,a=t.show;return p.a.createElement(m.f,{span:6,"data-url":n.url,className:"gutter-row coupon-item"},p.a.createElement("div",null,p.a.createElement("div",{className:"price"},p.a.createElement("em",null,"¥"),p.a.createElement("strong",null,n.priceLess)),p.a.createElement("div",null,p.a.createElement("span",{className:"limit"},n.condition),/m.jd/.test(n.url)?p.a.createElement("span",{className:"device"},"手机端"):p.a.createElement("span",{className:"device"},"PC端")),p.a.createElement("h3",{dangerouslySetInnerHTML:{__html:n.title}}),p.a.createElement("p",{dangerouslySetInnerHTML:{__html:n.note?n.note:"请确保已登陆京东"}}),p.a.createElement("p",null,n.baseUrl?p.a.createElement("a",{href:n.baseUrl,target:"_blank"},"直达优惠券页面"):"")),this.state.started?p.a.createElement("div",null,p.a.createElement("iframe",{id:"iframe"+n.id,src:""})):"",function(t){switch(a){case"all":return p.a.createElement("div",{className:"control"},p.a.createElement(m.b,{type:"primary",onClick:e.onCouponSelected.bind(e,t),disabled:t.isSelected},"选择"));case"selected":return p.a.createElement("div",{className:"control justify"},e.state.result?p.a.createElement(m.b,{type:"primary",onClick:e.endCoupon.bind(e,t)},"结束抢券"):p.a.createElement(m.b,{type:"primary",onClick:e.startCoupon.bind(e,t)},"开始抢券"),p.a.createElement(m.b,{type:"danger",onClick:e.onCouponSelected.bind(e,t)},"删除"))}}(n))}}]),t}(d.Component);t.a=f},1208:function(e,t,n){"use strict";var a=n(4),r=n.n(a),o=n(1),l=n.n(o),c=n(8),i=n.n(c),s=n(3),u=n.n(s),d=n(2),p=n.n(d),m=n(0),f=n.n(m),h=n(102),C=n(524),E=C.a.Item,v=C.c.TextArea,b=function(e){function t(){l()(this,t);var e=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleFormDataChange=function(t){e.setState({byData:!e.state.byData})},e.state={byData:!0},e}return p()(t,e),i()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,n=e.onCancel,a=e.onCreate,o=e.form,l=o.getFieldDecorator,c={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:18}}};return f.a.createElement(C.j,{visible:t,title:"添加优惠券",okText:"添加",cancelText:"取消",onCancel:n,onOk:a},f.a.createElement(C.a,{layout:"horizontal"},f.a.createElement(E,r()({},c,{label:"数据格式"}),l("dataType",{valuePropName:"checked"})(f.a.createElement(C.l,{checkedChildren:"字段",unCheckedChildren:"JSON",onChange:this.handleFormDataChange}))),this.state.byData?f.a.createElement(E,r()({},c,{label:f.a.createElement("span",null,"数据 ",f.a.createElement(C.i,{title:"请使用优惠券数据提取工具"},f.a.createElement(h.Link,{to:"/tool"},f.a.createElement(C.m,{type:"question-circle-o"})))),help:"支持数组或者对象数据提交"}),l("data",{rules:[{required:!0,message:"请填写数据"}]})(f.a.createElement(v,{rows:4,placeholder:"请填写数据"}))):f.a.createElement("div",null,f.a.createElement(E,r()({},c,{label:"标题"}),l("title",{rules:[{required:!0,message:"请填写标题"}]})(f.a.createElement(C.c,{placeholder:"请填写标题"}))),f.a.createElement(E,r()({},c,{label:f.a.createElement("span",null,"接口地址 ",f.a.createElement(C.i,{title:"请使用优惠券接口地址提取工具"},f.a.createElement(h.Link,{to:"/tool"},f.a.createElement(C.m,{type:"question-circle-o"}))))}),l("url",{rules:[{required:!0,message:"请输入接口地址"},{pattern:/^((https:|http:)?\/\/).*jd.com+.*/,message:"请输入正确的京东接口地址）"}]})(f.a.createElement(C.c,{placeholder:"请输入京东接口地址"}))),f.a.createElement(E,r()({},c,{label:"备注信息"}),l("note")(f.a.createElement(C.c,{placeholder:"备注信息"}))),f.a.createElement(E,r()({},c,{label:"折扣力度"}),l("priceLess",{rules:[{required:!0,message:"请填写折扣力度"}]})(f.a.createElement(C.c,{placeholder:"折扣力度"}))),f.a.createElement(E,r()({},c,{label:"条件"}),l("condition")(f.a.createElement(C.c,{placeholder:"满多少可用"}))))))}}]),t}(f.a.Component),g=C.a.create()(b);t.a=g},1209:function(e,t,n){"use strict";var a=n(25),r=n.n(a),o=n(1),l=n.n(o),c=n(8),i=n.n(c),s=n(3),u=n.n(s),d=n(2),p=n.n(d),m=n(0),f=n.n(m),h=n(1206),C=n(524),E=n(6),v=n.n(E),b=n(1208),g=n(1201),y=function(e){function t(){var e,n,a,o;l()(this,t);for(var c=arguments.length,i=Array(c),s=0;s<c;s++)i[s]=arguments[s];return n=a=u()(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),a.state={mode:"time",visible:!1,visibleAddCoupon:!1,date:""},a.handleOk=function(e){console.log(a.state.date),a.setState({visible:!1}),a.setTimer()},a.handleCancel=function(e){a.setState({visible:!1,visibleAddCoupon:!1})},a.handleOnChange=function(e,t){console.log(t),a.setState({date:t})},a.setCouponTime=function(){a.setState({visible:!0,date:v()(v()().valueOf()+5e3).format("YYYY-MM-DD HH:mm:ss")})},a.setTimer=function(){function e(){var a=(new Date).getTime();i++,console.log(a%1e3);var l=v()().valueOf()-(o+i*n),u=n-l;u<0&&(u=0),console.log(u),c<0||c<n?(clearTimeout(s),t.startCouponAll(),console.log((r-v()().valueOf())/1e3),console.log("时间到"),setTimeout(function(){t.endCouponAll()},3e3)):(C.h.info("距离开抢还有："+c/1e3+"s"),s=setTimeout(e,n)),c-=n}if(!a.props.selectedCoupons.length)return C.h.error("当前还没有选择任何优惠券");var t=a,n=1e3,r=v()(a.state.date).valueOf(),o=v()().valueOf(),l=o%1e3,c=r-o,i=0;console.log(c,l);var s=void 0;c>=0&&(s=setTimeout(e,1e3-l))},a.startCouponAll=function(){var e=a.props,t=e.couponStartedChange;if(!e.selectedCoupons.length)return C.h.error("当前还没有选择任何优惠券");t(!0)},a.endCouponAll=function(){var e=a.props,t=e.couponStartedChange,n=e.selectedCoupons;n.filter(function(e){return!0===e.started});if(!n.length)return C.h.error("当前还没有选择任何优惠券");t(!1)},a.addCoupon=function(){a.setState({visibleAddCoupon:!0})},a.handleCreate=function(){var e=a.props.couponAdd,t=a.form;t.validateFields(function(n,o){if(!n){if(o.data){try{o=JSON.parse(o.data)}catch(e){return C.h.error("数据格式错误")}if("object"!==(void 0===o?"undefined":r()(o)))return C.h.error("数据格式错误")}else delete o.dataType;console.log("Received values of form: ",o),e(o),t.resetFields(),a.setState({visibleAddCoupon:!1})}})},a.saveFormRef=function(e){a.form=e},o=n,u()(a,o)}return p()(t,e),i()(t,[{key:"render",value:function(){var e=this.props,t=e.selectedCoupons,n=e.coupons,a=e.couponSelected,r=n.list;C.a.Item;return f.a.createElement("div",null,f.a.createElement(g.a,null),f.a.createElement(C.d,{style:{marginTop:24},type:"inner",title:"抢券列表",extra:f.a.createElement("span",null,f.a.createElement(C.b,{type:"primary",onClick:this.startCouponAll},"一键抢券")," ",f.a.createElement(C.b,{type:"primary",onClick:this.endCouponAll},"一键结束")," ",f.a.createElement(C.b,{type:"primary",onClick:this.setCouponTime},"定时抢券"))},f.a.createElement(C.e,{gutter:50},t.map(function(e,t){return f.a.createElement(h.a,{item:e,key:e.id,couponSelected:a,show:"selected"})}))),f.a.createElement(C.d,{style:{marginTop:24},type:"inner",title:"优惠券列表",extra:f.a.createElement("span",null,f.a.createElement(C.b,{type:"primary",onClick:this.addCoupon},"添加优惠券"))},f.a.createElement(C.e,{gutter:50},r.map(function(e,t){return f.a.createElement(h.a,{item:e,key:e.id,couponSelected:a,show:"all"})}))),f.a.createElement(C.j,{visible:this.state.visible,okText:"确定",cancelText:"取消",onOk:this.handleOk,onCancel:this.handleCancel},f.a.createElement("div",null,f.a.createElement(C.k,{mode:this.state.mode,format:"YYYY-MM-DD HH:mm:ss",showTime:!0,value:v()(this.state.date,"YYYY-MM-DD HH:mm:ss"),onChange:this.handleOnChange,onPanelChange:this.handlePanelChange}),f.a.createElement("p",null,"准确的时间格式：2017-12-03 10:00:00，3秒后自动结束"))),f.a.createElement(b.a,{ref:this.saveFormRef,visible:this.state.visibleAddCoupon,onCancel:this.handleCancel,onCreate:this.handleCreate}))}}]),t}(m.Component);t.a=y}});